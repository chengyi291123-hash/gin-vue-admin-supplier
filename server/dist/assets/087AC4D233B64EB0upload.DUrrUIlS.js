/*! 
 Build based on gin-vue-admin 
 Time : 1763897842000 */
import{_ as e,C as a,a as l,U as t,g as s,b as n,d as o,e as i,c as u,f as d,i as r}from"./087AC4D233B64EB0QR-code.oUK1FRJ0.js";import{C as c}from"./087AC4D233B64EB0index.CJLTJMs8.js";import{a as p,g as m,ag as v,aa as g,c as f,o as h,b as w,f as y,w as k,n as x,t as I,i as b,d as _,h as C,q as D,ad as B,E,k as V,ah as j}from"./087AC4D233B64EB0index.0P5tyZxh.js";import{_ as A}from"./087AC4D233B64EB0warningBar.C_-K-Zvy.js";import"./087AC4D233B64EB0image.GvU-S7BA.js";import"./087AC4D233B64EB0_plugin-vue_export-helper.BCo6x5W8.js";import"./087AC4D233B64EB0vue-cropper.es.C5ptA6wF.js";import"./087AC4D233B64EB0logo.D8P6F9wK.js";const O=(e,a)=>{var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){var e=document.createElement("canvas");e.width=l.width,e.height=l.height,e.getContext("2d").drawImage(l,0,0,l.width,l.height);var t=e.toDataURL("image/png"),s=document.createElement("a"),n=new MouseEvent("click");s.download=a||"photo",s.href=t,s.dispatchEvent(n)},l.src=e},U={class:"flex gap-4 pt-2"},z={class:"flex-none w-64 bg-white text-slate-700 dark:text-slate-400 dark:bg-slate-900 rounded p-4"},S={class:"flex-1 bg-white text-slate-700 dark:text-slate-400 dark:bg-slate-900"},T={class:"gva-table-box mt-0 mb-0"},M={class:"gva-btn-list gap-3"},P=["onClick"],q={class:"gva-pagination"},L=Object.assign({name:"Upload"},{__name:"upload",setup(L){const R=p(!1),F=p("http://127.0.0.1:8888"),N=p(""),Q=p(""),G=p(1),H=p(0),J=p(10),K=p({keyword:null,classId:0}),W=p([]),X=e=>{J.value=e,$()},Y=e=>{G.value=e,$()},Z=()=>{K.value.classId=0,G.value=1,$()},$=async()=>{const e=await s({page:G.value,pageSize:J.value,...K.value});0===e.code&&(W.value=e.data.list,H.value=e.data.total,G.value=e.data.page,J.value=e.data.pageSize)};$();const ee=()=>{V.prompt("格式：文件名|链接或者仅链接。","导入",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"我的图片|https://my-oss.com/my.png\nhttps://my-oss.com/my_1.png",inputPattern:/\S/,inputErrorMessage:"不能为空"}).then(async({value:e})=>{let a=e.split("\n"),l=[];a.forEach(e=>{let a,t,s=e.trim().split("|");if(s.length>1)t=s[0].trim(),a=s[1];else{a=s[0].trim();let e=a.substring(a.lastIndexOf("/")+1);t=e.substring(0,e.lastIndexOf("."))}a&&l.push({name:t,url:a,classId:K.value.classId,tag:a.substring(a.lastIndexOf(".")+1),key:j()})});0===(await r(l)).code&&(E({type:"success",message:"导入成功!"}),await $())}).catch(()=>{E({type:"info",message:"取消导入"})})},ae=()=>{K.value.keyword=null,G.value=1,$()},le={children:"children",label:"name",value:"ID"},te=p([]),se=async()=>{const e=await n();let a={name:"全部分类",ID:0,pid:0,children:[]};0===e.code&&(te.value=e.data||[],te.value.unshift(a))},ne=e=>{K.value.keyword=null,K.value.classId=e.ID,G.value=1,$()},oe=p(!1),ie=p({ID:0,pid:0,name:""}),ue=p(null),de=p({name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{max:20,message:"最多20位字符",trigger:"blur"}]}),re=async()=>{ue.value.validate(async e=>{if(e){0===(await d(ie.value)).code&&(E({type:"success",message:"操作成功"}),await se(),ce())}})},ce=()=>{oe.value=!1,ie.value={ID:0,pid:0,name:""}};return se(),(s,n)=>{const d=m("MoreFilled"),r=m("el-icon"),p=m("Plus"),j=m("el-dropdown-item"),L=m("el-dropdown-menu"),pe=m("el-dropdown"),me=m("el-tree"),ve=m("el-scrollbar"),ge=m("el-button"),fe=m("el-input"),he=m("el-table-column"),we=m("el-tag"),ye=m("el-table"),ke=m("el-pagination"),xe=m("el-tree-select"),Ie=m("el-form-item"),be=m("el-form"),_e=m("el-dialog"),Ce=v("loading");return g((h(),f("div",null,[w("div",U,[w("div",z,[y(ve,{style:{height:"calc(100vh - 300px)"}},{default:k(()=>[y(me,{data:te.value,"node-key":"id",props:le,onNodeClick:ne,"default-expand-all":""},{default:k(({node:e,data:a})=>[w("div",{class:x(["w-36",K.value.classId===a.ID?"text-blue-500 font-bold":""])},I(a.name),3),y(pe,null,{dropdown:k(()=>[y(L,null,{default:k(()=>[y(j,{onClick:e=>{return l=a,oe.value=!0,ie.value.ID=0,void(ie.value.pid=l.ID);var l}},{default:k(()=>[...n[4]||(n[4]=[C("添加分类",-1)])]),_:1},8,["onClick"]),a.ID>0?(h(),b(j,{key:0,onClick:e=>{return l=a,ie.value={ID:l.ID,pid:l.pid,name:l.name},void(oe.value=!0);var l}},{default:k(()=>[...n[5]||(n[5]=[C("编辑分类",-1)])]),_:1},8,["onClick"])):_("",!0),a.ID>0?(h(),b(j,{key:1,onClick:e=>(async e=>{0===(await o({id:e})).code&&(E.success({type:"success",message:"删除成功"}),await se())})(a.ID)},{default:k(()=>[...n[6]||(n[6]=[C("删除分类",-1)])]),_:1},8,["onClick"])):_("",!0)]),_:2},1024)]),default:k(()=>[a.ID>0?(h(),b(r,{key:0,class:"ml-3 text-right"},{default:k(()=>[y(d)]),_:1})):(h(),b(r,{key:1,class:"ml-3 text-right mt-1"},{default:k(()=>[y(p)]),_:1}))]),_:2},1024)]),_:1},8,["data"])]),_:1})]),w("div",S,[w("div",T,[y(A,{title:"点击“文件名”可以编辑；选择的类别即是上传的类别。"}),w("div",M,[y(e,{"image-common":Q.value,classId:K.value.classId,onOnSuccess:ae},null,8,["image-common","classId"]),y(a,{classId:K.value.classId,onOnSuccess:ae},null,8,["classId"]),y(l,{classId:K.value.classId,onOnSuccess:ae},null,8,["classId"]),y(t,{"image-url":N.value,"file-size":512,"max-w-h":1080,classId:K.value.classId,onOnSuccess:ae},null,8,["image-url","classId"]),y(ge,{type:"primary",icon:"upload",onClick:ee},{default:k(()=>[...n[7]||(n[7]=[C(" 导入URL ",-1)])]),_:1}),y(fe,{modelValue:K.value.keyword,"onUpdate:modelValue":n[0]||(n[0]=e=>K.value.keyword=e),class:"w-72",placeholder:"请输入文件名或备注"},null,8,["modelValue"]),y(ge,{type:"primary",icon:"search",onClick:Z},{default:k(()=>[...n[8]||(n[8]=[C("查询 ",-1)])]),_:1})]),y(ye,{data:W.value},{default:k(()=>[y(he,{align:"left",label:"预览",width:"100"},{default:k(e=>[y(c,{"pic-type":"file","pic-src":e.row.url,preview:""},null,8,["pic-src"])]),_:1}),y(he,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:k(e=>[w("div",null,I(D(B)(e.row.UpdatedAt)),1)]),_:1}),y(he,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:k(e=>[w("div",{class:"cursor-pointer",onClick:a=>(async e=>{V.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then(async({value:a})=>{e.name=a,0===(await i(e)).code&&(E({type:"success",message:"编辑成功!"}),await $())}).catch(()=>{E({type:"info",message:"取消修改"})})})(e.row)},I(e.row.name),9,P)]),_:1}),y(he,{align:"left",label:"链接",prop:"url","min-width":"300"}),y(he,{align:"left",label:"标签",prop:"tag",width:"100"},{default:k(e=>{var a;return[y(we,{type:"jpg"===(null==(a=e.row.tag)?void 0:a.toLowerCase())?"info":"success","disable-transitions":""},{default:k(()=>[C(I(e.row.tag),1)]),_:2},1032,["type"])]}),_:1}),y(he,{align:"left",label:"操作",width:"160"},{default:k(e=>[y(ge,{icon:"download",type:"primary",link:"",onClick:a=>{var l;(l=e.row).url.indexOf("http://")>-1||l.url.indexOf("https://")>-1?O(l.url,l.name):O(F.value+"/"+l.url,l.name)}},{default:k(()=>[...n[9]||(n[9]=[C("下载 ",-1)])]),_:1},8,["onClick"]),y(ge,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{V.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{0===(await u(e)).code&&(E({type:"success",message:"删除成功!"}),1===W.value.length&&G.value>1&&G.value--,await $())}).catch(()=>{E({type:"info",message:"已取消删除"})})})(e.row)},{default:k(()=>[...n[10]||(n[10]=[C("删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),w("div",q,[y(ke,{"current-page":G.value,"page-size":J.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:H.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:Y,onSizeChange:X},null,8,["current-page","page-size","total"])])])])]),y(_e,{modelValue:oe.value,"onUpdate:modelValue":n[3]||(n[3]=e=>oe.value=e),onClose:ce,width:"520",title:(0===ie.value.ID?"添加":"编辑")+"分类",draggable:""},{footer:k(()=>[y(ge,{onClick:ce},{default:k(()=>[...n[11]||(n[11]=[C("取消",-1)])]),_:1}),y(ge,{type:"primary",onClick:re},{default:k(()=>[...n[12]||(n[12]=[C("确定",-1)])]),_:1})]),default:k(()=>[y(be,{ref_key:"categoryForm",ref:ue,rules:de.value,model:ie.value,"label-width":"80px"},{default:k(()=>[y(Ie,{label:"上级分类"},{default:k(()=>[y(xe,{modelValue:ie.value.pid,"onUpdate:modelValue":n[1]||(n[1]=e=>ie.value.pid=e),data:te.value,"check-strictly":"",props:le,"render-after-expand":!1,style:{width:"240px"}},null,8,["modelValue","data"])]),_:1}),y(Ie,{label:"分类名称",prop:"name"},{default:k(()=>[y(fe,{modelValue:ie.value.name,"onUpdate:modelValue":n[2]||(n[2]=e=>ie.value.name=e),modelModifiers:{trim:!0},placeholder:"分类名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])])),[[Ce,R.value,void 0,{fullscreen:!0,lock:!0}]])}}});export{L as default};

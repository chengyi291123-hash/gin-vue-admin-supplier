/*! 
 Build based on gin-vue-admin 
 Time : 1764067928000 */
import{aj as e,u as a,a as t,l as s,D as l,U as n,aw as u,I as r,g as o,c as i,o as v,f as m,a8 as c,w as p,F as d,K as y,i as g,b as f,n as h,h as b,t as S,q,al as x,ax as I,a9 as w,$ as k,X as O}from"./087AC4D233B64EB0index.CKMyeZDq.js";import{_ as N}from"./087AC4D233B64EB0_plugin-vue_export-helper.BCo6x5W8.js";const C={class:"gva-tabs"},E=["tab"],J=N(Object.assign({name:"HistoryComponent"},{__name:"index",setup(N){const J=e(),_=a(),j=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),A=t([]),P=t(""),V=t(!1),T=s(),B=t(0),L=t(0),R=t(!1),D=t(!1),U=t(""),K=l(()=>T.userInfo.authority.defaultRouter),X=()=>{A.value=[{name:K.value,meta:{title:"首页"},query:{},params:{}}],_.push({name:K.value}),V.value=!1,sessionStorage.setItem("historys",JSON.stringify(A.value))},$=()=>{let e;const a=A.value.findIndex(a=>(j(a)===U.value&&(e=a),j(a)===U.value)),t=A.value.findIndex(e=>j(e)===P.value);A.value.splice(0,a),a>t&&_.push(e),sessionStorage.setItem("historys",JSON.stringify(A.value))},F=()=>{let e;const a=A.value.findIndex(a=>(j(a)===U.value&&(e=a),j(a)===U.value)),t=A.value.findIndex(e=>j(e)===P.value);A.value.splice(a+1,A.value.length),a<t&&_.push(e),sessionStorage.setItem("historys",JSON.stringify(A.value))},H=()=>{let e;A.value=A.value.filter(a=>(j(a)===U.value&&(e=a),j(a)===U.value)),_.push(e),sessionStorage.setItem("historys",JSON.stringify(A.value))},M=e=>{if(!A.value.some(a=>((e,a)=>{if(e.name!==a.name)return!1;if(Object.keys(e.query).length!==Object.keys(a.query).length||Object.keys(e.params).length!==Object.keys(a.params).length)return!1;for(const t in e.query)if(e.query[t]!==a.query[t])return!1;for(const t in e.params)if(e.params[t]!==a.params[t])return!1;return!0})(a,e))){const a={};a.name=e.name,a.meta={...e.meta},delete a.meta.matched,a.query=e.query,a.params=e.params,A.value.push(a)}window.sessionStorage.setItem("activeValue",j(e))},Q=t({}),Y=e=>{var a;const t=null==(a=null==e?void 0:e.props)?void 0:a.name;if(!t)return;const s=Q.value[t];_.push({name:s.name,query:s.query,params:s.params})},z=e=>{const a=A.value.findIndex(a=>j(a)===e);j(J)===e&&(1===A.value.length?_.push({name:K.value}):a<A.value.length-1?_.push({name:A.value[a+1].name,query:A.value[a+1].query,params:A.value[a+1].params}):_.push({name:A.value[a-1].name,query:A.value[a-1].query,params:A.value[a-1].params})),A.value.splice(a,1)};n(()=>V.value,()=>{V.value?document.body.addEventListener("click",()=>{V.value=!1}):document.body.removeEventListener("click",()=>{V.value=!1})}),n(()=>J,e=>{"Login"!==e.name&&"Reload"!==e.name&&(A.value=A.value.filter(e=>!e.meta.closeTab),M(e),sessionStorage.setItem("historys",JSON.stringify(A.value)),P.value=window.sessionStorage.getItem("activeValue"))},{deep:!0}),n(()=>A.value,()=>{sessionStorage.setItem("historys",JSON.stringify(A.value)),Q.value={},A.value.forEach(e=>{Q.value[j(e)]=e}),r.emit("setKeepAlive",A.value)},{deep:!0});(()=>{r.on("closeThisPage",()=>{z(j(J))}),r.on("closeAllPage",()=>{X()}),r.on("mobile",e=>{D.value=e}),r.on("collapse",e=>{R.value=e}),r.on("setQuery",e=>{const a=A.value.findIndex(e=>j(e)===P.value);A.value[a].query=e,P.value=j(A.value[a]);const t=window.location.href.split("?")[0],s=new URLSearchParams(e).toString();window.history.replaceState({},"","".concat(t,"?").concat(s)),sessionStorage.setItem("historys",JSON.stringify(A.value))}),r.on("switchTab",async e=>{const a=A.value.findIndex(a=>a.name===e.name);if(!(a<0)){for(const a in e.query)e.query[a]=String(e.query[a]);for(const a in e.params)e.params[a]=String(e.params[a]);A.value[a].query=e.query||{},A.value[a].params=e.params||{},await O(),_.push(A.value[a])}});const e=[{name:K.value,meta:{title:"首页"},query:{},params:{}}];M(J),A.value=JSON.parse(sessionStorage.getItem("historys"))||e,window.sessionStorage.getItem("activeValue")?P.value=window.sessionStorage.getItem("activeValue"):P.value=j(J),"true"===window.sessionStorage.getItem("needCloseAll")&&(X(),window.sessionStorage.removeItem("needCloseAll"))})(),u(()=>{r.off("collapse"),r.off("mobile")});return(e,a)=>{const t=o("el-tab-pane"),s=o("el-tabs");return v(),i("div",C,[m(s,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),closable:!(1===A.value.length&&e.$route.name===K.value),type:"card",class:"bg-white text-slate-700 dark:text-slate-500 dark:bg-slate-900 pt-1",onContextmenu:a[1]||(a[1]=I(e=>(e=>{if(1===A.value.length&&J.name===K.value)return!1;let a="";a="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,a&&(V.value=!0,B.value=e.clientX,L.value=e.clientY+10,U.value=a.substring(4))})(e),["prevent"])),onTabClick:Y,onTabRemove:z,onMouseup:a[2]||(a[2]=I(e=>(e=>{if(1===A.value.length&&J.name===K.value)return!1;let a="";a="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,a&&z(a.substring(4))})(e),["middle","prevent"]))},{default:p(()=>[(v(!0),i(d,null,y(A.value,e=>(v(),g(t,{key:j(e),label:e.meta.title,name:j(e),tab:e,class:"border-none"},{label:p(()=>[f("span",{tab:e,class:h(P.value===j(e)?"text-active":"text-gray-600 dark:text-slate-400 ")},[f("i",{class:h(P.value===j(e)?"text-active":"text-gray-600 dark:text-slate-400")},null,2),b(" "+S(q(x)(e.meta.title,e)),1)],10,E)]),_:2},1032,["label","name","tab"]))),128))]),_:1},8,["modelValue","closable"]),c(f("ul",{style:k({left:B.value+"px",top:L.value+"px"}),class:"contextmenu"},[f("li",{onClick:X},"关闭所有"),f("li",{onClick:$},"关闭左侧"),f("li",{onClick:F},"关闭右侧"),f("li",{onClick:H},"关闭其他")],4),[[w,V.value]])])}}}),[["__scopeId","data-v-79679bb5"]]);export{J as default};

/*! 
 Build based on gin-vue-admin 
 Time : 1764044126000 */
import{N as e,a,U as l,g as t,c as u,o,f as i,b as d,w as s,h as r,q as n,i as m,d as p,X as c,bj as v,E as h,bk as g,k as f,bl as y,bm as w,bn as b,bo as V}from"./087AC4D233B64EB0index.CvFrmKQM.js";import{g as I}from"./087AC4D233B64EB0authority.D4Wq_ZvS.js";import{C as k}from"./087AC4D233B64EB0index.CXgiDtPF.js";import{_}from"./087AC4D233B64EB0warningBar.DpvUzqs6.js";import{S as C}from"./087AC4D233B64EB0selectImage.D1AKDM6b.js";import"./087AC4D233B64EB0_plugin-vue_export-helper.BCo6x5W8.js";import"./087AC4D233B64EB0image.GvU-S7BA.js";import"./087AC4D233B64EB0QR-code.C3NVe_DB.js";import"./087AC4D233B64EB0vue-cropper.es.Cm9PtUeD.js";import"./087AC4D233B64EB0logo.D8P6F9wK.js";const N={class:"gva-search-box"},D={class:"gva-table-box"},B={class:"gva-btn-list"},U={class:"gva-pagination"},x={class:"flex w-full"},z={class:"dialog-footer"},j={class:"flex justify-between items-center"},E=Object.assign({name:"User"},{__name:"user",setup(E){const A=e(),S=a({username:"",nickname:"",phone:"",email:""}),q=()=>{F.value=1,H()},O=()=>{S.value={username:"",nickname:"",phone:"",email:""},H()},T=(e,a)=>{e&&e.forEach(e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};T(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}})},F=a(1),J=a(0),M=a(10),P=a([]),R=e=>{M.value=e,H()},$=e=>{F.value=e,H()},H=async()=>{const e=await V({page:F.value,pageSize:M.value,...S.value});0===e.code&&(P.value=e.data.list,J.value=e.data.total,F.value=e.data.page,M.value=e.data.pageSize)};l(()=>P.value,()=>{Y()});const Q=a([]);(async()=>{H();const e=await I();var a;a=e.data,Q.value=[],T(a,Q.value)})();const W=a(!1),X=a(null),Z=a({ID:"",userName:"",nickName:"",password:""}),G=()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let a="";for(let l=0;l<12;l++)a+=e.charAt(Math.floor(70*Math.random()));Z.value.password=a,navigator.clipboard.writeText(a).then(()=>{h({type:"success",message:"密码已复制到剪贴板"})}).catch(()=>{h({type:"error",message:"复制失败，请手动复制"})})},K=async()=>{if(!Z.value.password)return void h({type:"warning",message:"请输入或生成密码"});const e=await w({ID:Z.value.ID,password:Z.value.password});0===e.code?(h({type:"success",message:e.msg||"密码重置成功"}),W.value=!1):h({type:"error",message:e.msg||"密码重置失败"})},L=()=>{Z.value.password="",W.value=!1},Y=()=>{P.value&&P.value.forEach(e=>{e.authorityIds=e.authorities&&e.authorities.map(e=>e.authorityId)})},ee=a({userName:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),ae=a({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),le=a(null),te=async()=>{ee.value.authorityId=ee.value.authorityIds[0],le.value.validate(async e=>{if(e){const e={...ee.value};if("add"===ie.value){0===(await b(e)).code&&(h({type:"success",message:"创建成功"}),await H(),oe())}if("edit"===ie.value){0===(await g(e)).code&&(h({type:"success",message:"编辑成功"}),await H(),oe())}}})},ue=a(!1),oe=()=>{le.value.resetFields(),ee.value.headerImg="",ee.value.authorityIds=[],ue.value=!1},ie=a("add"),de=()=>{ie.value="add",ue.value=!0},se={},re=async(e,a,l)=>{if(a)return void(l||(se[e.ID]=[...e.authorityIds]));await c();0===(await v({ID:e.ID,authorityIds:e.authorityIds})).code?h({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...se[e.ID]],delete se[e.ID])};return(e,a)=>{const l=t("el-input"),v=t("el-form-item"),w=t("el-button"),b=t("el-form"),V=t("el-table-column"),I=t("el-cascader"),E=t("el-switch"),T=t("el-table"),Y=t("el-pagination"),se=t("el-dialog"),ne=t("el-drawer");return o(),u("div",null,[i(_,{title:"注：右上角头像下拉可切换角色"}),d("div",N,[i(b,{ref:"searchForm",inline:!0,model:S.value},{default:s(()=>[i(v,{label:"用户名"},{default:s(()=>[i(l,{modelValue:S.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>S.value.username=e),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),i(v,{label:"昵称"},{default:s(()=>[i(l,{modelValue:S.value.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>S.value.nickname=e),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),i(v,{label:"手机号"},{default:s(()=>[i(l,{modelValue:S.value.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>S.value.phone=e),placeholder:"手机号"},null,8,["modelValue"])]),_:1}),i(v,{label:"邮箱"},{default:s(()=>[i(l,{modelValue:S.value.email,"onUpdate:modelValue":a[3]||(a[3]=e=>S.value.email=e),placeholder:"邮箱"},null,8,["modelValue"])]),_:1}),i(v,null,{default:s(()=>[i(w,{type:"primary",icon:"search",onClick:q},{default:s(()=>[...a[17]||(a[17]=[r(" 查询 ",-1)])]),_:1}),i(w,{icon:"refresh",onClick:O},{default:s(()=>[...a[18]||(a[18]=[r(" 重置 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",D,[d("div",B,[i(w,{type:"primary",icon:"plus",onClick:de},{default:s(()=>[...a[19]||(a[19]=[r("新增用户",-1)])]),_:1})]),i(T,{data:P.value,"row-key":"ID"},{default:s(()=>[i(V,{align:"left",label:"头像","min-width":"75"},{default:s(e=>[i(k,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])]),_:1}),i(V,{align:"left",label:"ID","min-width":"50",prop:"ID"}),i(V,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),i(V,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),i(V,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),i(V,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),i(V,{align:"left",label:"用户角色","min-width":"200"},{default:s(e=>[i(I,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:Q.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{re(e.row,a,0)},onRemoveTag:a=>{re(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])]),_:1}),i(V,{align:"left",label:"启用","min-width":"150"},{default:s(e=>[i(E,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{ee.value=JSON.parse(JSON.stringify(e)),await c();const a={...ee.value};0===(await g(a)).code&&(h({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await H(),ee.value.headerImg="",ee.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),i(V,{label:"操作","min-width":n(A).operateMinWith,fixed:"right"},{default:s(e=>[i(w,{type:"primary",link:"",icon:"delete",onClick:a=>(async e=>{f.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{0===(await y({id:e.ID})).code&&(h.success("删除成功"),await H())})})(e.row)},{default:s(()=>[...a[20]||(a[20]=[r("删除",-1)])]),_:1},8,["onClick"]),i(w,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,ie.value="edit",ee.value=JSON.parse(JSON.stringify(l)),void(ue.value=!0);var l}},{default:s(()=>[...a[21]||(a[21]=[r("编辑",-1)])]),_:1},8,["onClick"]),i(w,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,Z.value.ID=l.ID,Z.value.userName=l.userName,Z.value.nickName=l.nickName,Z.value.password="",void(W.value=!0);var l}},{default:s(()=>[...a[22]||(a[22]=[r("重置密码",-1)])]),_:1},8,["onClick"])]),_:1},8,["min-width"])]),_:1},8,["data"]),d("div",U,[i(Y,{"current-page":F.value,"page-size":M.value,"page-sizes":[10,30,50,100],total:J.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:$,onSizeChange:R},null,8,["current-page","page-size","total"])])]),i(se,{modelValue:W.value,"onUpdate:modelValue":a[7]||(a[7]=e=>W.value=e),title:"重置密码",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:s(()=>[d("div",z,[i(w,{onClick:L},{default:s(()=>[...a[24]||(a[24]=[r("取 消",-1)])]),_:1}),i(w,{type:"primary",onClick:K},{default:s(()=>[...a[25]||(a[25]=[r("确 定",-1)])]),_:1})])]),default:s(()=>[i(b,{model:Z.value,ref_key:"resetPwdForm",ref:X,"label-width":"100px"},{default:s(()=>[i(v,{label:"用户账号"},{default:s(()=>[i(l,{modelValue:Z.value.userName,"onUpdate:modelValue":a[4]||(a[4]=e=>Z.value.userName=e),disabled:""},null,8,["modelValue"])]),_:1}),i(v,{label:"用户昵称"},{default:s(()=>[i(l,{modelValue:Z.value.nickName,"onUpdate:modelValue":a[5]||(a[5]=e=>Z.value.nickName=e),disabled:""},null,8,["modelValue"])]),_:1}),i(v,{label:"新密码"},{default:s(()=>[d("div",x,[i(l,{class:"flex-1",modelValue:Z.value.password,"onUpdate:modelValue":a[6]||(a[6]=e=>Z.value.password=e),placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),i(w,{type:"primary",onClick:G,style:{"margin-left":"10px"}},{default:s(()=>[...a[23]||(a[23]=[r(" 生成随机密码 ",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),i(ne,{modelValue:ue.value,"onUpdate:modelValue":a[16]||(a[16]=e=>ue.value=e),size:n(A).drawerSize,"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{header:s(()=>[d("div",j,[a[28]||(a[28]=d("span",{class:"text-lg"},"用户",-1)),d("div",null,[i(w,{onClick:oe},{default:s(()=>[...a[26]||(a[26]=[r("取 消",-1)])]),_:1}),i(w,{type:"primary",onClick:te},{default:s(()=>[...a[27]||(a[27]=[r("确 定",-1)])]),_:1})])])]),default:s(()=>[i(b,{ref_key:"userForm",ref:le,rules:ae.value,model:ee.value,"label-width":"80px"},{default:s(()=>["add"===ie.value?(o(),m(v,{key:0,label:"用户名",prop:"userName"},{default:s(()=>[i(l,{modelValue:ee.value.userName,"onUpdate:modelValue":a[8]||(a[8]=e=>ee.value.userName=e)},null,8,["modelValue"])]),_:1})):p("",!0),"add"===ie.value?(o(),m(v,{key:1,label:"密码",prop:"password"},{default:s(()=>[i(l,{modelValue:ee.value.password,"onUpdate:modelValue":a[9]||(a[9]=e=>ee.value.password=e)},null,8,["modelValue"])]),_:1})):p("",!0),i(v,{label:"昵称",prop:"nickName"},{default:s(()=>[i(l,{modelValue:ee.value.nickName,"onUpdate:modelValue":a[10]||(a[10]=e=>ee.value.nickName=e)},null,8,["modelValue"])]),_:1}),i(v,{label:"手机号",prop:"phone"},{default:s(()=>[i(l,{modelValue:ee.value.phone,"onUpdate:modelValue":a[11]||(a[11]=e=>ee.value.phone=e)},null,8,["modelValue"])]),_:1}),i(v,{label:"邮箱",prop:"email"},{default:s(()=>[i(l,{modelValue:ee.value.email,"onUpdate:modelValue":a[12]||(a[12]=e=>ee.value.email=e)},null,8,["modelValue"])]),_:1}),i(v,{label:"用户角色",prop:"authorityId"},{default:s(()=>[i(I,{modelValue:ee.value.authorityIds,"onUpdate:modelValue":a[13]||(a[13]=e=>ee.value.authorityIds=e),style:{width:"100%"},options:Q.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])]),_:1}),i(v,{label:"启用",prop:"disabled"},{default:s(()=>[i(E,{modelValue:ee.value.enable,"onUpdate:modelValue":a[14]||(a[14]=e=>ee.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1}),i(v,{label:"头像","label-width":"80px"},{default:s(()=>[i(C,{modelValue:ee.value.headerImg,"onUpdate:modelValue":a[15]||(a[15]=e=>ee.value.headerImg=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","size"])])}}});export{E as default};

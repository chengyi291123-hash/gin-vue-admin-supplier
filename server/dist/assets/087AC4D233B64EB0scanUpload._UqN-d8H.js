/*! 
 Build based on gin-vue-admin 
 Time : 1764067928000 */
import{a as e,v as a,u as l,x as o,c as t,b as u,f as s,w as n,q as r,y as c,g as i,i as d,d as p,F as v,o as f,z as m,A as g,B as h,C as x,h as w,t as y,E as k,j as C}from"./087AC4D233B64EB0index.CKMyeZDq.js";import{M as _}from"./087AC4D233B64EB0vue-cropper.es.YvgOuIG3.js";import{_ as b}from"./087AC4D233B64EB0_plugin-vue_export-helper.BCo6x5W8.js";const B={class:"flex justify-center w-full pt-2"},R={class:"flex flex-col w-full h-auto p-0 pt-4"},j={class:"flex-1 min-h-[60vh]"},z={class:"w-screen h-[calc(100vh-175px)] rounded"},A={key:1,class:"flex justify-center items-center w-full h-[calc(100vh-175px)]"},D={class:"toolbar"},E=b(Object.assign({name:"scanUpload"},{__name:"scanUpload",setup(b){const E=e(0),U=e(""),F=e(!1),I=e(300),S=function(){I.value=window.innerWidth};a(()=>{S(),window.addEventListener("resize",S)});const $=l();$.isReady().then(()=>{let e=$.currentRoute.value.query;E.value=e.id,U.value=e.token}).catch(e=>{});const q=e(null),L=e(""),V=e(null),{proxy:W}=o(),H=e({}),M=e(!1),N=e=>{W.$refs.cropperRef.changeScale(e)},O=e([1,1]),T=e(300),G=e(300),J=e(!1),K=e=>{if(!e.raw.type.includes("image"))return void k.error("请选择图片文件");if(e.raw.size/1024/1024>8)return k.error("文件大小不能超过8MB!"),!1;const a=C.service({lock:!0,text:"请稍后",background:"rgba(0, 0, 0, 0.7)"}),l=new FileReader;l.onload=e=>{L.value=e.target.result,a.close()},l.readAsDataURL(e.raw)},P=e=>{-90===e?W.$refs.cropperRef.rotateLeft():W.$refs.cropperRef.rotateRight()},Q=()=>{if(M.value=!0,!1===F.value)return q.value.submit(),!0;W.$refs.cropperRef.getCropBlob(e=>{try{const a=new File([e],"".concat(Date.now(),".jpg"),{type:"image/jpeg"});q.value.clearFiles(),q.value.handleStart(a),q.value.submit()}catch(a){M.value=!1,k.error("上传失败: "+a.message)}})},X=e=>{const{data:a}=e;a&&(L.value=null,M.value=!1,H.value={},k.success("上传成功"))};return(e,a)=>{const l=i("el-icon"),o=i("el-upload"),k=i("el-image"),C=i("el-button"),b=i("el-tooltip"),S=i("el-button-group"),$=i("el-switch");return f(),t(v,null,[u("div",B,[s(o,{ref_key:"uploadRef",ref:q,class:"h5-uploader",action:"".concat(r(c)(),"/fileUploadAndDownload/upload"),accept:"image/*","show-file-list":!1,"auto-upload":!1,headers:{"x-token":U.value},data:{classId:E.value},"on-success":X,"on-change":K},{default:n(()=>[s(l,{class:"h5-uploader-icon"},{default:n(()=>[s(r(m))]),_:1})]),_:1},8,["action","headers","data"])]),u("div",R,[u("div",j,[u("div",z,[F.value?(f(),d(r(_),{key:0,ref_key:"cropperRef",ref:V,img:L.value,mode:"contain",outputType:"jpeg",autoCrop:!0,autoCropWidth:T.value,autoCropHeight:G.value,fixedBox:!1,fixed:J.value,fixedNumber:O.value,centerBox:!0,canMoveBox:!0,full:!1,maxImgSize:I.value,original:!0},null,8,["img","autoCropWidth","autoCropHeight","fixed","fixedNumber","maxImgSize"])):(f(),t("div",A,[L.value?(f(),d(k,{key:0,src:L.value,class:"max-w-full max-h-full",mode:"cover"},null,8,["src"])):p("",!0)]))])])]),u("div",D,[F.value?(f(),d(S,{key:0},{default:n(()=>[s(b,{content:"向左旋转"},{default:n(()=>[s(C,{onClick:a[0]||(a[0]=e=>P(-90)),icon:r(g)},null,8,["icon"])]),_:1}),s(b,{content:"向右旋转"},{default:n(()=>[s(C,{onClick:a[1]||(a[1]=e=>P(90)),icon:r(h)},null,8,["icon"])]),_:1}),s(C,{icon:r(m),onClick:a[2]||(a[2]=e=>N(1))},null,8,["icon"]),s(C,{icon:r(x),onClick:a[3]||(a[3]=e=>N(-1))},null,8,["icon"])]),_:1})):p("",!0),s($,{size:"large",modelValue:F.value,"onUpdate:modelValue":a[4]||(a[4]=e=>F.value=e),"inline-prompt":"","active-text":"裁剪","inactive-text":"裁剪"},null,8,["modelValue"]),s(C,{type:"primary",onClick:Q,loading:M.value},{default:n(()=>[w(y(M.value?"上传中...":"上 传"),1)]),_:1},8,["loading"])])],64)}}}),[["__scopeId","data-v-71b771ce"]]);export{E as default};
